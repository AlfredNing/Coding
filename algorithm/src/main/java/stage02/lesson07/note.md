>请设计一个提供UUID的系统，从原理上不能产生相同的UUID，给全球使用
>
>- 同步+标识：会产生强一致的时间同步问题
>
>解法1：设计一个皇帝系统，下面有各大洲系统，各大区域系统，各大省市系统，每一个系统向他的父系统获取能拿到的范围值 **垂直扩展**

- 子数组： 一定是连续的
- 子序列：可以是不连续的

# 数组累加和 - lesson07

## 题一 LongestSumSubArrayLengthInPositiveArray

给定一个数组arr, 数组里面都是正数，给出sum值，请求出满足sum值得最长子数组

**流程**

起始位置：[0,0] 窗口区域L，R windowSum

1. windowSum < Sum  R右移
2. windowSum  > Sum , L 右移
3. windowSum  = Sum , **都可以**，进行一个操作，会带动另外一个操作，这里选择L右移

##  题二 LongestSumSubArrayLength

给定一个数组arr, 数组里面有正数 负数 0 ，给出sum值，请求出满足sum值得最长子数组

假设 0 - 10 连续和为1000 要求连续和为200的，既就是从0-10求出最早连续和为800的

**重要：** 准备一个map <子数组和，最早的下标> 但一定初始化时候放入（0,-1) 否则在整个数组为结果的时候，查询不到

## 题三 LongestLessSumSubArrayLength

给定一个数组arr, 数组里面有正数 负数 0 ，给出sum值，设定 只要满足 <= sum 既就是达标 。请求出最长子数组

**流程：**

准备两个辅助数组：

minSum : 表示从i位置起最小的子数组和

minSumEnd:表示从i位置起最小的子数组的最右位置、终止位置

**舍弃可能性的结果**

**N * logN**

# 哈希

哈希算法理论是不是O(1)但在使用的时候可以认为O(1)，因为实现中有多种优化方式

![image-20220904124432962](C:\Users\15667\AppData\Roaming\Typora\typora-user-images\image-20220904124432962.png)

## 布隆过滤器

例如黑名单系统，降低空间使用。

高效地插入和查询，可以用来告诉你 **“某样东西一定不存在或者可能存在”**。

**不支持删除**

实现：

![image-20220904123112772](C:\Users\15667\AppData\Roaming\Typora\typora-user-images\image-20220904123112772.png)

![image-20220904122454406](C:\Users\15667\AppData\Roaming\Typora\typora-user-images\image-20220904122454406.png)

**如何找出K个哈希函数：**

找出两个哈希函数：f() 和 g()

f() +1 * g() => 第三个

f() +2 * g() => 第四个

......

# 一致性哈希

解决数据分布式存储方案

## 传统后端系统业务

>前段 nginx + 逻辑层 + 数据服务层【数据库】
>
>分布式数据库要求选择合适的key去做hash求模
>
>原因：
>
>1. 避免机器的分配不均衡
>2. 如果涉及到热点key的查询，比如排行榜，会造成各台机器去做查询，之后去做merge，会造成性能损耗
>
>要选择大量的key，哈希的均分配体现在有大量的样本量数据当中，例如：身份证

## **分布式哈希**

没有取模的概念。

类似一个环形结构，每一台机器在环形结构上面有确定的值，对于到来的数据，顺时针选择机器作为自己的存储机器。

### 机器数量更改

1. 下线一台机器：将自己的数据量转移到下一台机器当中
2. 上线一台机器：手法依旧

### 两个问题

1. 如果一开始机器数量很小的话，用hash值做不到均分。离线函数很可能让两个值很近
2. 可能情况下，一开始很均分，加入或者减少机器造成不均分

解决方案：**虚拟节点**

> 哈希碰撞：如果你的数据量没有过四千亿，一般不用考虑出现哈希碰撞的情况。

m1机器：a1,a2....a1000

m2机器：b1,b2....b1000

m3机器：c1,c2....c1000

让这三个点去换上分配，实际转换为所对应的物理机器，**实现负载均衡**

假设m1机器性能好，给m1分配多哥节点，实现**负载管理**

亚马逊仓库： 给每一种商品分配哈希值，充满仓库，用户下单，走最短路径

# 并行算法 

## 岛问题

一个只有0和1两种数字的二维矩阵中，上下左右的能连成一片1的，算一个岛。返回矩阵中，一共有几个岛。

解决方案：从起点出发，遇到1的变成2。其它情况不发生改变。**IsLands**

问题： 如果是全世界的岛屿计算，单台机器是无法完成的，引用分布式计算。

**计算逻辑：**

1. 每台计算机跑一部分进行计算
2. 开始对每台机器进行岛屿计算，不过此时要记录，从最开始的位置起点的信息。
3. 计算完成转换，对分割线进行合并，每次起始的位置都在同一个分割线的点。总岛屿-1

# 资源限制技巧汇总

1. 布隆过滤器用户集合的建立与查询，并可以节省大量空间
2. 一致性哈希解决数据服务器的负载管理问题
3. 利用并查集结构做岛问题的并行计算
4. 哈希函数可以把数据按照种类均匀分流
5. 位图解决某一范围数字的出现情况，并可以节省大量空间
6. 利用分段统计思想，并进一步节省大量空间
7. 利用堆、外排序来做多个处理单元的结果合并

### 题目1：

32位无符号的整数范围是0-4,294,967,296

现在有一个正好包含40亿个无符号整数的文件，

所以整个范围中必然存在没出现过的数。

1. 可以使用最多1G的内存，怎么找到所有未出现过得数？
2. 内存限制为10MB，但是只用找到一个没出现过的数即可。
3. 内存限制为3kb，但是只用找到一个没出现过的数即可。
4. 内存限制为三个变量，但是只用找到一个没出现过的数即可。

解：

1. 利用位图，2^32可以表示 0 - 2^32 - 1的所有的数 16G / 32. 500M
2. 2问和3问一个解法。
   1. 3 kb  / 4 = 750个整形数组 离750最近的2的次方 => 9 
   2. 整形数组：512长度，2^32一定可以被512均分 =》 8,388,608
   3. 第0份统计：0- 8,388,608 * 1，第1份：  8,388,608 *1， 8,388,608 *2
   4. 进来数字除以8,388,608 求得第几份。肯定存在某一份不在 8,388,608
   5. 找到那一份，然后用3kb去分，知道可以满足3kb，可以表示所有数据
3. 4问题，用二分法求中间。一直找到剩下最后的一个数。0， 2^31,2^32，假设从0 -  2^31 遍历所有的数，假设都出现且不重复，下次中间位置 + 1，进行二分。

### 题目2：

有一个包含100亿个URL的大问题，假设每个url占用64B,请找出其中所有重复的URL.

【补充】

某搜索公司一天的用户搜索词汇是海量的【百亿数据量】请设计出一种求出每天热门TOP100的词汇的可行方法。

**问题很模糊，面试官考察对问题的定位能力，与其交谈，深入了解问题。**

**不怕重复的数，就怕种类太多的数**

1问：

根据url 取哈希1 对机器数量模，写入每台的文件中，在对每台机器的小文件进行哈希2 取模，相同url会写入同一个文件。对每个文件求重复。进行汇总。



哈希1 与哈希2 哈希函数+模值不能相同，否则就会产生一个文件。

补充问：

解法一：利用外排序，在每个小文件中进行排序，之后对所有的小文件进行取值。

解法2：利用二维堆，小文件里面维持一个100的大根堆。外部把所有的小文件又组织成一个堆。每次弹出堆顶。堆内元素上提，再进行调整堆。文件比较 -》 机器比较。求出TOPN

### 题目3：

32位无符号整数的范围是0-4,294,967,296。现在有40个亿无符号整数，可以最多使用10Mb,怎么找到上中位数。

与题目1类似，位置划分。进行累计。当累计到某个位置当中，超过20亿了。在对该位置进行进行划分，求解。

### 题目4：

32位无符号整数的范围是0-4,294,967,296

有一个10G大小的文件，每一行都装着这种类型的数字，整个文件是无序的，给你5G的内存空间。

请输出一个10大小的文件，就是原文件所有数字排序后的结果

准备一个小根堆。小跟堆元素存放的是文件遍历中最大的前几个数。

小根堆记录<数字，词频> 防止重复词太多

map<数字，小根堆中位置> 

1. 遍历当前数>当前堆顶大的数,堆顶弹出，数进入，调整堆结构
2. 遍历结束之后，用t变量记录堆顶元素，堆输出到一个文件当中
3. 再次只遍历>t变量记录的数
4. 重复上述步骤，结束。

估计map和小跟堆得占用空间大小
